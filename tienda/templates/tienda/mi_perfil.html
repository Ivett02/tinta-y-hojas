{% extends 'tienda/base.html' %}

{% block content %}
<div style="max-width: 1000px; margin: 40px auto; display: grid; grid-template-columns: 1fr 2fr; gap: 40px;">

    <div class="card" style="height: fit-content;">
        <h2 style="color: #800000; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0;">Mi Perfil</h2>
        
        <div style="text-align: center; margin: 20px 0;">
            {% if user.perfil.foto %}
                <img src="{{ user.perfil.foto.url }}" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #D4AF37;">
            {% else %}
                <div style="width: 120px; height: 120px; border-radius: 50%; background: #eee; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 3rem;">ðŸ‘¤</div>
            {% endif %}
            <h3 style="margin: 10px 0;">{{ user.username }}</h3>
            <p style="color: #666;">{{ user.email }}</p>
        </div>

        <form method="post" enctype="multipart/form-data" style="margin-top: 20px;">
            {% csrf_token %}
            
            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; display: block; margin-bottom: 5px;">TelÃ©fono:</label>
                {{ form.telefono }}
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; display: block; margin-bottom: 5px;">DirecciÃ³n Predeterminada:</label>
                {{ form.direccion }}
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; display: block; margin-bottom: 5px;">Cambiar Foto:</label>
                {{ form.foto }}
            </div>

            <button type="submit" class="btn" style="width: 100%;">Guardar Cambios</button>
        </form>
    </div>

    <div class="card">
        <h2 style="color: #800000; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0;">Mis Pedidos Recientes</h2>

        {% if pedidos %}
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead style="background-color: #333; color: white;">
                    <tr>
                        <th style="padding: 12px; text-align: left;">Pedido</th>
                        <th style="padding: 12px; text-align: center;">Fecha</th>
                        <th style="padding: 12px; text-align: center;">Total</th>
                        <th style="padding: 12px; text-align: center;">Estado</th>
                        <th style="padding: 12px; text-align: center;">Detalle</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pedido in pedidos %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 15px;">
                            <strong>#{{ pedido.id }}</strong>
                        </td>
                        <td style="padding: 15px; text-align: center; color: #666;">
                            {{ pedido.fecha_pedido|date:"d/m/Y" }}
                        </td>
                        <td style="padding: 15px; text-align: center; font-weight: bold;">
                            ${{ pedido.total_final }}
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            {% if pedido.estado == 'pendiente' %}
                                <span style="background: #ffeeba; color: #856404; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">Pendiente</span>
                            {% elif pedido.estado == 'pagado' %}
                                <span style="background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">Pagado</span>
                            {% else %}
                                <span style="background: #cce5ff; color: #004085; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">Enviado</span>
                            {% endif %}
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <a href="{% url 'pedido_exitoso' pedido.id %}" class="btn-recibo" title="Ver Recibo Completo">
                                ðŸ“„ Ver Recibo
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div style="text-align: center; padding: 40px; color: #666;">
                <p>AÃºn no has realizado ninguna compra.</p>
                <a href="{% url 'catalogo' %}" style="color: #800000; font-weight: bold;">Â¡Explora nuestro catÃ¡logo!</a>
            </div>
        {% endif %}
    </div>

</div>

<style>
    
    input[type="text"], textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box; 
    }
    textarea {
        resize: vertical;
        min-height: 60px;
    }

    
    .btn-recibo {
        text-decoration: none;
        background-color: #f8f9fa;
        color: #333;
        border: 1px solid #ccc;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.9rem;
        transition: all 0.2s;
        display: inline-block;
    }
    .btn-recibo:hover {
        background-color: #800000;
        color: white;
        border-color: #800000;
    }
</style>
{% endblock %}